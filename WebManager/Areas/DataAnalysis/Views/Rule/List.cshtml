@using System;
@using WeiCode.Utility;
@using WeiCode.DataBase;
@using WeiCode.Services;
@using WeiCode.ModelDbs;
@using WeiCode.Domain;
@using Services.Project;
@using WeiCode.Models;

@{
    Layout = ModelBasic.PageModel.GetLayout();
}

<style>
    .layui-card {
        margin: 15px;
    }

    .search-box {
        padding: 15px;
        background-color: #f2f2f2;
    }
</style>
<div class="layui-card-body">
    <!-- 搜索区域 -->
    <div class="search-box">
        <form class="layui-form" action="">
            <div class="layui-form-item">
                <div class="layui-inline">
                    <button type="button" class="layui-btn" onclick="add()">创建</button>
                </div>
            </div>
        </form>
    </div>

    <!-- 数据表格 -->
    <table id="dataTable" lay-filter="dataTable"></table>
</div>

<script>
    function add() {
        // iframe 层
        layer.open({
            type: 2,
            title: '创建规则',
            shadeClose: true,
            shade: 0.8,
            area: ['1200px', '400px'],
            content: '/DataAnalysis/Rule/Add' // iframe 的 url
        });
    };

    layui.use(['table', 'form'], function () {
        var table = layui.table;
        var form = layui.form;
        var layer = layui.layer;
       

        // 初始化表格
        table.render({
            elem: '#dataTable',
            url: '/DataAnalysis/Rule/GetRuleData', // 数据接口
            page: true, // 开启分页
            cols: [[ // 表头
                { field: 'id', title: 'ID', width: 80, sort: true },
                { field: 'c_rule', title: '规则', width: 120 },
                { field: 'remake', title: '备注', width: 300 },
                { field: 'create_time', title: '创建时间', width: 160, sort: true },
                { fixed: 'right', title: '操作', width: 150, align: 'center', toolbar: '#toolBar' }
            ]]
        });

        // 搜索功能
        form.on('submit(search)', function (data) {
            table.reload('dataTable', {
                where: data.field
            });
            return false;
        });

        // 监听工具条
        table.on('tool(dataTable)', function (obj) {
            var data = obj.data;
            if (obj.event === 'detail') {
                layer.msg('ID：' + data.id + ' 的查看操作');
            } else if (obj.event === 'edit') {
                layer.msg('ID：' + data.id + ' 的编辑操作');
            } else if (obj.event === 'del') {
                layer.confirm('确认删除吗？', function (index) {
                    obj.del();
                    layer.close(index);
                });
            }
        });
    });</script>

<!-- 工具栏模板 -->
<script type="text/html" id="toolBar">
    <a class="layui-btn layui-btn-xs" lay-event="detail">查看</a>
    <a class="layui-btn layui-btn-xs layui-btn-warm" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="del">删除</a>
</script>